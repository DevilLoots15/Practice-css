<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aviator</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #000000;
            --bg-stage: #0f0f0f;
            --bg-panel: #1b1c1d;
            --bg-input: #0f0f0f;
            --accent-red: #E91E63;
            --accent-green: #28a745;
            --accent-orange: #ff9800;
            --text-white: #ffffff;
            --text-grey: #9ca0a9;
            --pill-blue: #34b4ff; /* 2x */
            --pill-purple: #c017b4; /* 10x */
            --pill-classic: #2c2d30; /* 1x */
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            background-color: var(--bg-body);
            font-family: 'Roboto', sans-serif;
            color: var(--text-white);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        .header {
            height: 54px;
            background: #1b1c1d;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            border-bottom: 1px solid #2c2d30;
            z-index: 10;
        }
        .logo { 
            font-weight: 900; 
            font-size: 20px; 
            font-style: italic; 
            letter-spacing: -1px; 
        }
        .logo span { color: var(--accent-red); }
        .balance-box {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        .balance-val { color: var(--accent-green); font-weight: 700; font-size: 16px; }
        .balance-label { font-size: 10px; color: var(--text-grey); }

        /* --- History Bar --- */
        .history-bar {
            height: 36px;
            background: #141516;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 10px;
            gap: 6px;
            overflow: hidden;
            position: relative;
        }
        .history-pill {
            background: var(--pill-classic);
            color: #999;
            padding: 2px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .history-pill.blue { color: var(--pill-blue); border: 1px solid rgba(52,180,255,0.2); }
        .history-pill.purple { color: var(--pill-purple); border: 1px solid rgba(192,23,180,0.2); }
        .history-icon {
            font-size: 14px; color: #555; margin-right: auto; padding-left: 5px; cursor: pointer;
        }

        /* --- Game Stage --- */
        .stage-container {
            flex: 1;
            position: relative;
            background: #0f0f0f;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* Overlay Elements */
        .multiplier-display {
            position: absolute;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 72px;
            font-weight: 900;
            color: white;
            z-index: 5;
            font-variant-numeric: tabular-nums;
        }

        .flew-away-badge {
            position: absolute;
            top: 38%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }
        .flew-away-text {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-red);
            text-transform: uppercase;
            margin-bottom: 5px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .flew-away-val {
            font-size: 60px;
            font-weight: 900;
            color: var(--accent-red);
        }

        .loading-spinner {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none; /* Flex when active */
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        .spinner-icon {
            width: 40px; height: 40px;
            border: 4px solid #333;
            border-top: 4px solid var(--accent-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .loading-text { font-size: 12px; color: #666; font-weight: 500; letter-spacing: 1px; }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Betting Controls --- */
        .controls-area {
            background: #141516;
            padding: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
            min-height: 160px;
        }

        /* The Bet Panel (Card) */
        .bet-panel {
            background: var(--bg-panel);
            width: 100%;
            max-width: 450px;
            border-radius: 12px;
            padding: 10px 15px;
            display: flex;
            flex-direction: column;
            border: 1px solid #2c2d30;
        }

        /* Tabs (Bet / Auto) */
        .tabs {
            display: flex;
            margin-bottom: 10px;
            background: #111;
            border-radius: 20px;
            padding: 3px;
            width: fit-content;
            align-self: center;
        }
        .tab {
            padding: 4px 15px;
            font-size: 11px;
            border-radius: 15px;
            color: #888;
            cursor: pointer;
            font-weight: 700;
        }
        .tab.active { background: #2c2d30; color: #fff; }

        /* Main Inputs Layout */
        .panel-row {
            display: grid;
            grid-template-columns: 1fr 140px;
            gap: 10px;
            height: 100%;
        }

        /* Bet Input Section */
        .bet-input-box {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .counter-input {
            display: flex;
            background: #000;
            border: 1px solid #333;
            border-radius: 6px;
            height: 40px;
            align-items: center;
            padding: 0 5px;
        }
        .btn-inc {
            width: 30px; height: 100%;
            background: transparent; border: none; color: #fff; font-size: 18px; cursor: pointer;
        }
        .input-val {
            flex: 1;
            background: transparent; border: none; color: #fff;
            text-align: center; font-weight: 700; font-size: 16px;
            width: 100%; outline: none;
        }

        .quick-presets {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-top: 8px;
        }
        .preset {
            background: #2c2d30;
            border: none;
            border-radius: 4px;
            color: #fff;
            font-size: 10px;
            padding: 6px;
            cursor: pointer;
        }

        /* Big Action Button */
        .action-btn {
            width: 100%;
            height: 100%;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Roboto', sans-serif;
            position: relative;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            transition: all 0.1s;
        }
        .action-btn:active { transform: translateY(2px); box-shadow: none; }

        .btn-green { background: var(--accent-green); }
        .btn-green .lbl { font-size: 18px; font-weight: 700; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        .btn-green .sub { font-size: 10px; font-weight: 500; color: #dfffd6; margin-top: 2px; text-transform: uppercase;}

        .btn-orange { background: var(--accent-orange); border: 1px solid #fff; }
        .btn-orange .lbl { font-size: 16px; font-weight: 700; color: #fff; }
        .btn-orange .sub { font-size: 14px; font-weight: 900; color: #fff; margin-top: 2px; }

        .btn-red { background: #d32f2f; cursor: default; }
        .btn-red .lbl { font-size: 12px; font-weight: 700; color: #fff; }
        .btn-red:active { transform: none; box-shadow: 0 4px 0 rgba(0,0,0,0.2); }

    </style>
</head>
<body>

    <div class="header">
        <div class="logo">Aviator</div>
        <div class="balance-box">
            <span class="balance-val"><span id="balance">1000.00</span> INR</span>
            <span class="balance-label">DEMO BALANCE</span>
        </div>
    </div>

    <div class="history-bar" id="historyBar">
        <div class="history-icon">ðŸ•’</div>
        <div class="history-pill blue">2.14x</div>
        <div class="history-pill">1.12x</div>
        <div class="history-pill purple">14.50x</div>
    </div>

    <div class="stage-container">
        <canvas id="gameCanvas"></canvas>
        
        <div class="multiplier-display" id="bigMult">1.00x</div>
        
        <div class="flew-away-badge" id="crashBadge">
            <div class="flew-away-text">FLEW AWAY!</div>
            <div class="flew-away-val" id="crashValue">2.45x</div>
        </div>

        <div class="loading-spinner" id="loader">
            <div class="spinner-icon"></div>
            <div class="loading-text">WAITING FOR NEXT ROUND</div>
            <div style="width: 100px; height: 4px; background: #222; border-radius: 2px; margin-top:5px; overflow:hidden;">
                <div id="loaderBar" style="width:0%; height:100%; background: #E91E63; transition: width 0.1s linear;"></div>
            </div>
        </div>
    </div>

    <div class="controls-area">
        <div class="bet-panel">
            <div class="tabs">
                <div class="tab active">Bet</div>
                <div class="tab">Auto</div>
            </div>
            
            <div class="panel-row">
                <div class="bet-input-box">
                    <div class="counter-input">
                        <button class="btn-inc" onclick="adjBet(-10)">âˆ’</button>
                        <input type="number" id="betInput" class="input-val" value="10.00">
                        <button class="btn-inc" onclick="adjBet(10)">+</button>
                    </div>
                    <div class="quick-presets">
                        <button class="preset" onclick="setBet(100)">100</button>
                        <button class="preset" onclick="setBet(200)">200</button>
                        <button class="preset" onclick="setBet(500)">500</button>
                        <button class="preset" onclick="setBet(1000)">1000</button>
                    </div>
                </div>

                <button class="action-btn btn-green" id="mainBtn">
                    <div class="lbl">BET</div>
                    <div class="sub" id="btnSub">USD</div>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- Core Setup ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // UI Elements
        const ui = {
            balance: document.getElementById('balance'),
            history: document.getElementById('historyBar'),
            mult: document.getElementById('bigMult'),
            crashBadge: document.getElementById('crashBadge'),
            crashVal: document.getElementById('crashValue'),
            loader: document.getElementById('loader'),
            loaderBar: document.getElementById('loaderBar'),
            betInput: document.getElementById('betInput'),
            mainBtn: document.getElementById('mainBtn'),
            btnSub: document.getElementById('btnSub')
        };

        // Game State
        let state = {
            balance: 1000.00,
            betAmount: 10.00,
            phase: 'IDLE', // IDLE, LOADING, FLYING, CRASHED
            betPlaced: false, // Is bet queued for NEXT round?
            betActive: false, // Is bet currently riding?
            multiplier: 1.00,
            startTime: 0,
            crashPoint: 0,
            stars: []
        };

        // Assets
        const planeImg = new Image();
        // SVG Base64 of the plane (Red)
        planeImg.src = `data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IiNFOTFFNjMiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTIxIDE2djQtMmwtOC01VjdsOCA1em0tMTAgNHYtM2w0IDN2M3ptLTggNHYtMmwyLTF2M2wtMiAweiIvPjwvc3ZnPg==`;
        
        // --- Resize Logic ---
        let width, height;
        function resize() {
            width = canvas.parentElement.clientWidth;
            height = canvas.parentElement.clientHeight;
            canvas.width = width;
            canvas.height = height;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- Starfield System (Background) ---
        function initStars() {
            state.stars = [];
            for(let i=0; i<50; i++) {
                state.stars.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    size: Math.random() * 2,
                    speed: 1 + Math.random() * 2
                });
            }
        }
        initStars();

        function drawStars(speedMult) {
            ctx.fillStyle = '#1b1c1d'; // Clear color
            ctx.fillRect(0,0,width,height);
            
            ctx.fillStyle = '#555';
            state.stars.forEach(star => {
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI*2);
                ctx.fill();
                
                // Move stars left based on speedMult
                star.x -= star.speed * speedMult;
                if(star.x < 0) {
                    star.x = width;
                    star.y = Math.random() * height;
                }
            });
        }

        // --- Game Logic ---

        function updateBalance(val) {
            state.balance = val;
            ui.balance.textContent = val.toFixed(2);
        }

        function setBet(val) { ui.betInput.value = val; }
        function adjBet(delta) { 
            let v = Number(ui.betInput.value) + delta;
            if(v < 1) v = 1;
            ui.betInput.value = v;
        }

        // Button Click Handler
        ui.mainBtn.onclick = () => {
            const amt = Number(ui.betInput.value);
            
            if(state.phase === 'FLYING') {
                if(state.betActive) {
                    // CASHOUT
                    cashOut();
                } else if(!state.betPlaced) {
                    // Place for NEXT round
                    if(state.balance < amt) return alert("Low balance");
                    state.betPlaced = true;
                    state.betAmount = amt;
                    updateBalance(state.balance - amt);
                    renderBtnState();
                } else {
                    // Cancel Next Round Bet
                    state.betPlaced = false;
                    updateBalance(state.balance + state.betAmount);
                    renderBtnState();
                }
            } else if (state.phase === 'LOADING' || state.phase === 'IDLE' || state.phase === 'CRASHED') {
                if(!state.betPlaced) {
                    // Place Bet
                    if(state.balance < amt) return alert("Low balance");
                    state.betPlaced = true;
                    state.betAmount = amt;
                    updateBalance(state.balance - amt);
                    renderBtnState();
                } else {
                    // Cancel Bet
                    state.betPlaced = false;
                    updateBalance(state.balance + state.betAmount);
                    renderBtnState();
                }
            }
        };

        function cashOut() {
            const win = state.betAmount * state.multiplier;
            updateBalance(state.balance + win);
            state.betActive = false;
            state.betPlaced = false; // Reset
            
            // Visual feedback
            ui.mainBtn.className = 'action-btn btn-green'; // Keep it green but show text
            ui.mainBtn.innerHTML = `<div class="lbl">WON ${win.toFixed(2)}</div>`;
            setTimeout(renderBtnState, 2000);
        }

        function renderBtnState() {
            // Reset classes
            ui.mainBtn.className = 'action-btn';
            
            if(state.phase === 'FLYING' && state.betActive) {
                // CASHOUT MODE
                ui.mainBtn.classList.add('btn-orange');
                ui.mainBtn.innerHTML = `<div class="lbl">CASH OUT</div><div class="sub">${(state.betAmount * state.multiplier).toFixed(2)} INR</div>`;
                return;
            }

            if(state.betPlaced) {
                // WAITING/CANCEL MODE
                ui.mainBtn.classList.add('btn-red');
                ui.mainBtn.innerHTML = `<div class="lbl">WAITING</div><div class="sub">CANCEL</div>`;
                
                // If we are flying and bet is for NEXT round
                if(state.phase === 'FLYING') {
                    ui.mainBtn.innerHTML = `<div class="lbl">BET PLACED</div><div class="sub">FOR NEXT ROUND</div>`;
                }
                return;
            }

            // DEFAULT BET MODE
            ui.mainBtn.classList.add('btn-green');
            ui.mainBtn.innerHTML = `<div class="lbl">BET</div><div class="sub">${Number(ui.betInput.value).toFixed(2)} INR</div>`;
        }

        // --- Loop & Engine ---

        function addHistory(mult) {
            const el = document.createElement('div');
            el.className = `history-pill ${mult >= 10 ? 'purple' : mult >= 2 ? 'blue' : ''}`;
            el.textContent = mult.toFixed(2) + 'x';
            // Insert after the icon
            ui.history.insertBefore(el, ui.history.children[1]); 
            if(ui.history.children.length > 20) ui.history.lastChild.remove();
        }

        function startLoading() {
            state.phase = 'LOADING';
            state.multiplier = 1.00;
            ui.mult.style.display = 'none';
            ui.crashBadge.style.display = 'none';
            ui.loader.style.display = 'flex';
            
            // Background idle
            drawStars(0.2); 
            renderBtnState();

            let p = 0;
            const int = setInterval(() => {
                p += 2;
                ui.loaderBar.style.width = p + '%';
                drawStars(0.2);
                if(p >= 100) {
                    clearInterval(int);
                    startFlight();
                }
            }, 60); // 3 seconds load
        }

        function startFlight() {
            state.phase = 'FLYING';
            ui.loader.style.display = 'none';
            ui.mult.style.display = 'block';
            state.startTime = Date.now();
            state.crashPoint = generateCrash();
            
            // Lock bets
            if(state.betPlaced) {
                state.betActive = true;
            }
            renderBtnState();
            
            requestAnimationFrame(gameLoop);
        }

        function generateCrash() {
            // Spribe-like algo approximation
            const r = Math.random();
            const crash = 0.99 / (1 - r);
            return Math.max(1.00, Math.min(crash, 1000));
        }

        function gameLoop() {
            if(state.phase !== 'FLYING') return;

            const elapsed = Date.now() - state.startTime;
            // Exponential growth function
            state.multiplier = 1.0 + 0.00006 * elapsed + Math.pow(elapsed/1000, 2) * 0.05;

            // UI Updates
            ui.mult.textContent = state.multiplier.toFixed(2) + 'x';
            if(state.betActive) renderBtnState(); // Update cashout amount

            // Canvas Drawing
            drawStars(state.multiplier); // Stars move faster as mult grows
            drawCurve(state.multiplier);

            // Crash Check
            if(state.multiplier >= state.crashPoint) {
                crash();
            } else {
                requestAnimationFrame(gameLoop);
            }
        }

        function drawCurve(m) {
            // Visualize the "Take off"
            // We keep the plane somewhat centered horizontally, and move vertical based on mult
            const normMult = Math.min((m - 1) / 5, 1); // Normalise 0 to 1 for first 5x
            
            const startX = 0;
            const startY = height;
            
            // Target position for plane
            const planeX = width * 0.2 + (width * 0.5 * normMult); 
            const planeY = height - (height * 0.1) - (height * 0.7 * normMult);
            
            // Draw Bezier Fill
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.quadraticCurveTo(planeX * 0.5, height, planeX, planeY);
            ctx.lineTo(planeX, height);
            ctx.lineTo(0, height);
            ctx.fillStyle = 'rgba(233, 30, 99, 0.2)';
            ctx.fill();

            // Draw Line
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.quadraticCurveTo(planeX * 0.5, height, planeX, planeY);
            ctx.lineWidth = 4;
            ctx.strokeStyle = '#E91E63';
            ctx.stroke();

            // Draw Plane
            const pSize = 60;
            ctx.drawImage(planeImg, planeX - pSize/2, planeY - pSize/2, pSize, pSize);
        }

        function crash() {
            state.phase = 'CRASHED';
            ui.mult.style.display = 'none';
            ui.crashVal.textContent = state.multiplier.toFixed(2) + 'x';
            ui.crashBadge.style.display = 'flex';
            
            addHistory(state.multiplier);
            
            // Reset Logic
            if(state.betActive) {
                state.betActive = false;
                state.betPlaced = false;
                // Loss happened
            }
            renderBtnState();

            // Wait 3s then restart
            setTimeout(startLoading, 3000);
        }

        // Start
        startLoading();

    </script>
</body>
</html>
