<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aviator Pro - Real Experience</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #0a0a0a;
            --bg-stage: #101112;
            --bg-panel: #1b1c1d;
            --accent-red: #E91E63;
            --accent-green: #28a745;
            --accent-orange: #ff9800;
            --text-white: #ffffff;
            --text-muted: #9ca0a9;
            --border-color: #2c2d30;
            --btn-shadow: 0 3px 0 rgba(0,0,0,0.3);
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            background-color: var(--bg-body);
            font-family: 'Roboto', sans-serif;
            color: var(--text-white);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        .header {
            height: 50px;
            background: var(--bg-panel);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
            z-index: 20;
        }
        .logo { font-weight: 900; font-size: 22px; font-style: italic; letter-spacing: -1px; color: #fff; display: flex; align-items: center; gap: 6px; }
        .logo span { color: var(--accent-red); }
        
        .header-right { display: flex; align-items: center; gap: 12px; }
        .balance-box { text-align: right; line-height: 1.2; }
        .balance-val { color: var(--accent-green); font-weight: 700; font-size: 16px; display: block; }
        .currency { font-size: 10px; color: var(--text-muted); }

        .btn-sound {
            background: rgba(255,255,255,0.1); border: 1px solid var(--border-color);
            color: var(--text-muted); width: 32px; height: 32px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 14px;
        }
        .btn-sound.active { color: var(--accent-green); border-color: var(--accent-green); background: rgba(40, 167, 69, 0.1); }

        /* --- History Bar --- */
        .history-bar {
            height: 30px;
            background: #141516;
            display: flex;
            align-items: center;
            padding: 0 10px;
            gap: 6px;
            border-bottom: 1px solid #000;
            flex-shrink: 0;
            overflow: hidden;
        }
        .hist-pill {
            background: #202124; color: #999; padding: 2px 8px; border-radius: 10px;
            font-size: 10px; font-weight: 700; min-width: 35px; text-align: center; border: 1px solid transparent;
        }
        .hist-pill.p-blue { color: #34b4ff; background: rgba(52,180,255,0.1); border-color: rgba(52,180,255,0.15); }
        .hist-pill.p-purple { color: #c017b4; background: rgba(192,23,180,0.1); border-color: rgba(192,23,180,0.15); }
        .hist-pill.p-pink { color: var(--accent-red); background: rgba(233,30,99,0.1); }

        /* --- Main Content Area --- */
        .main-wrapper {
            display: flex;
            flex-direction: column;
            flex: 1;
            height: calc(100vh - 80px); /* Subtract header/history */
            overflow: hidden;
        }

        /* --- Game Canvas Area --- */
        .game-stage {
            flex: 1; /* Takes available space */
            position: relative;
            background: var(--bg-stage);
            overflow: hidden;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        canvas { width: 100%; height: 100%; display: block; }

        /* Overlays */
        .center-overlay {
            position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; pointer-events: none; z-index: 10;
        }
        .big-mult {
            font-size: 70px; font-weight: 900; color: #fff;
            text-shadow: 0 4px 20px rgba(0,0,0,0.5); font-variant-numeric: tabular-nums;
        }
        
        .crash-msg {
            display: none; flex-direction: column; align-items: center;
        }
        .crash-title { font-size: 24px; font-weight: 700; color: var(--accent-red); margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .crash-val { font-size: 60px; font-weight: 900; color: var(--accent-red); }

        .loader {
            position: absolute; top: 60%; left: 50%; transform: translate(-50%, -50%);
            display: none; flex-direction: column; align-items: center; gap: 10px; z-index: 10;
        }
        .loader-spinner {
            width: 40px; height: 40px; border: 4px solid #333; border-top: 4px solid var(--accent-red);
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        .loader-text { font-size: 12px; color: #888; font-weight: 500; letter-spacing: 1px; margin-top: 5px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Betting Controls (Compact Mobile) --- */
        .controls-area {
            background: #141516;
            padding: 8px 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-shrink: 0;
            /* Ensure it fits on screen without scrolling if possible */
            max-height: 45vh; 
            overflow-y: auto;
        }

        .bet-panel {
            background: var(--bg-panel);
            border-radius: 8px;
            padding: 6px 10px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .panel-top { display: flex; justify-content: space-between; align-items: center; height: 24px; }
        .tabs { background: #000; border-radius: 12px; padding: 2px; display: flex; }
        .tab { padding: 2px 10px; font-size: 10px; color: #777; border-radius: 10px; cursor: pointer; font-weight: 700; }
        .tab.active { background: #333; color: #fff; }
        
        .control-row { display: grid; grid-template-columns: 1fr 120px; gap: 10px; align-items: stretch; height: 50px; }

        .input-box { display: flex; flex-direction: column; justify-content: space-between; height: 100%; }
        
        .counter {
            display: flex; background: #000; border: 1px solid #333; border-radius: 6px;
            height: 28px; align-items: center; padding: 0 4px;
        }
        .btn-pm { width: 24px; height: 100%; background: none; border: none; color: #aaa; font-size: 18px; cursor: pointer; }
        .inp-val { flex: 1; background: none; border: none; color: #fff; text-align: center; font-weight: 700; font-size: 14px; outline: none; }
        
        .presets { display: flex; gap: 4px; margin-top: 2px; }
        .btn-pre { flex: 1; background: #2c2d30; border: none; border-radius: 4px; color: #fff; font-size: 9px; padding: 3px 0; cursor: pointer; }

        /* Big Action Button */
        .btn-action {
            width: 100%; height: 100%; border: none; border-radius: 8px; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; box-shadow: var(--btn-shadow); transition: transform 0.05s;
        }
        .btn-action:active { transform: translateY(2px); box-shadow: none; }
        
        .bg-green { background: var(--accent-green); }
        .bg-orange { background: var(--accent-orange); border: 1px solid rgba(255,255,255,0.3); }
        .bg-red { background: #d32f2f; } /* Waiting/Cancel */

        .lbl-lg { font-size: 16px; font-weight: 900; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.3); line-height: 1; }
        .lbl-sm { font-size: 10px; font-weight: 500; color: rgba(255,255,255,0.9); margin-top: 2px; text-transform: uppercase; }

        /* --- Desktop Layout --- */
        @media (min-width: 768px) {
            .main-wrapper { flex-direction: row; padding: 20px; gap: 20px; background: #000; height: calc(100vh - 50px); }
            .game-stage { border-radius: 12px; border: 1px solid var(--border-color); }
            .controls-area {
                width: 360px; background: transparent; padding: 0; overflow: visible; gap: 15px; border: none;
            }
            .bet-panel { height: 140px; padding: 12px; }
            .control-row { height: 60px; }
            .counter { height: 36px; }
            .lbl-lg { font-size: 20px; }
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">Aviator <span>PRO</span></div>
        <div class="header-right">
            <button class="btn-sound" id="btnSound">ðŸ”‡</button>
            <div class="balance-box">
                <span class="balance-val" id="uiBalance">10,000.00</span>
                <span class="currency">INR</span>
            </div>
        </div>
    </div>

    <div class="history-bar" id="historyBar">
        <div style="padding:0 8px; color:#555; cursor:pointer">ðŸ•’</div>
        </div>

    <div class="main-wrapper">
        
        <div class="game-stage">
            <canvas id="canvas"></canvas>
            
            <div class="center-overlay">
                <div class="big-mult" id="elMult">1.00x</div>
                <div class="crash-msg" id="elCrash">
                    <div class="crash-title">FLEW AWAY!</div>
                    <div class="crash-val" id="elCrashVal">1.00x</div>
                </div>
            </div>

            <div class="loader" id="elLoader">
                <div class="loader-spinner"></div>
                <div class="loader-text">WAITING FOR NEXT ROUND</div>
            </div>
        </div>

        <div class="controls-area">
            
            <div class="bet-panel">
                <div class="panel-top">
                    <div class="tabs">
                        <div class="tab active">Bet</div>
                        <div class="tab">Auto</div>
                    </div>
                </div>
                <div class="control-row">
                    <div class="input-box">
                        <div class="counter">
                            <button class="btn-pm" onclick="game.adjustBet(1, -10)">-</button>
                            <input type="number" id="inpBet1" class="inp-val" value="10">
                            <button class="btn-pm" onclick="game.adjustBet(1, 10)">+</button>
                        </div>
                        <div class="presets">
                            <button class="btn-pre" onclick="game.setBet(1, 100)">100</button>
                            <button class="btn-pre" onclick="game.setBet(1, 500)">500</button>
                            <button class="btn-pre" onclick="game.setBet(1, 1000)">1k</button>
                        </div>
                    </div>
                    <button class="btn-action bg-green" id="btnBet1" onclick="game.clickBtn(1)">
                        <div class="lbl-lg">BET</div>
                        <div class="lbl-sm">10.00 INR</div>
                    </button>
                </div>
            </div>

            <div class="bet-panel">
                <div class="panel-top">
                    <div class="tabs">
                        <div class="tab active">Bet</div>
                        <div class="tab">Auto</div>
                    </div>
                </div>
                <div class="control-row">
                    <div class="input-box">
                        <div class="counter">
                            <button class="btn-pm" onclick="game.adjustBet(2, -10)">-</button>
                            <input type="number" id="inpBet2" class="inp-val" value="50">
                            <button class="btn-pm" onclick="game.adjustBet(2, 10)">+</button>
                        </div>
                        <div class="presets">
                            <button class="btn-pre" onclick="game.setBet(2, 100)">100</button>
                            <button class="btn-pre" onclick="game.setBet(2, 500)">500</button>
                            <button class="btn-pre" onclick="game.setBet(2, 1000)">1k</button>
                        </div>
                    </div>
                    <button class="btn-action bg-green" id="btnBet2" onclick="game.clickBtn(2)">
                        <div class="lbl-lg">BET</div>
                        <div class="lbl-sm">50.00 INR</div>
                    </button>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- PRO AUDIO ENGINE (Web Audio API) ---
        const AudioEngine = {
            ctx: null,
            bgOsc: null,
            bgGain: null,
            engineOsc: null,
            engineGain: null,
            isEnabled: false,

            init() {
                if (!this.ctx) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (this.ctx.state === 'suspended') {
                    this.ctx.resume();
                }
                this.isEnabled = true;
                // Start background rumble immediately
                this.startAmbience();
            },

            toggle() {
                if (this.isEnabled) {
                    this.stopAll();
                    this.isEnabled = false;
                    return false;
                } else {
                    this.init();
                    return true;
                }
            },

            stopAll() {
                if(this.bgOsc) { this.bgOsc.stop(); this.bgOsc = null; }
                this.stopEngine();
            },

            // Low frequency background rumble
            startAmbience() {
                if(!this.isEnabled) return;
                this.bgOsc = this.ctx.createOscillator();
                this.bgGain = this.ctx.createGain();
                
                this.bgOsc.frequency.value = 50; // Low rumble
                this.bgGain.gain.value = 0.05; // Very quiet

                this.bgOsc.connect(this.bgGain);
                this.bgGain.connect(this.ctx.destination);
                this.bgOsc.start();
            },

            // The Rising Plane Sound
            startEngine() {
                if(!this.isEnabled) return;
                this.stopEngine();

                this.engineOsc = this.ctx.createOscillator();
                this.engineOsc.type = 'sawtooth';
                this.engineOsc.frequency.value = 100; // Start pitch

                // Lowpass filter to make it sound like an engine, not a video game beep
                const filter = this.ctx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.value = 300;

                this.engineGain = this.ctx.createGain();
                this.engineGain.gain.value = 0.1;

                this.engineOsc.connect(filter);
                filter.connect(this.engineGain);
                this.engineGain.connect(this.ctx.destination);
                
                this.engineOsc.start();
                this.filter = filter; // Save ref to modulate later
            },

            updateEngine(mult) {
                if(!this.engineOsc || !this.isEnabled) return;
                // Pitch rises with multiplier
                // Cap pitch at 600Hz so it doesn't hurt ears
                const targetFreq = 100 + (mult * 40);
                const safeFreq = Math.min(targetFreq, 800);
                
                this.engineOsc.frequency.setTargetAtTime(safeFreq, this.ctx.currentTime, 0.1);
                // Open filter slightly as it goes faster
                this.filter.frequency.setTargetAtTime(300 + (mult * 50), this.ctx.currentTime, 0.1);
            },

            stopEngine() {
                if(this.engineOsc) {
                    const now = this.ctx.currentTime;
                    this.engineGain.gain.exponentialRampToValueAtTime(0.001, now + 0.5);
                    this.engineOsc.stop(now + 0.5);
                    this.engineOsc = null;
                }
            },

            playWin() {
                if(!this.isEnabled) return;
                const osc = this.ctx.createOscillator();
                const g = this.ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200, this.ctx.currentTime + 0.1);
                g.gain.setValueAtTime(0.3, this.ctx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.5);
                osc.connect(g); g.connect(this.ctx.destination);
                osc.start(); osc.stop(this.ctx.currentTime + 0.5);
            },

            playCrash() {
                if(!this.isEnabled) return;
                // White noise burst
                const bufferSize = this.ctx.sampleRate * 0.5;
                const b = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
                const d = b.getChannelData(0);
                for(let i=0; i<bufferSize; i++) d[i] = Math.random() * 2 - 1;

                const src = this.ctx.createBufferSource();
                src.buffer = b;
                const g = this.ctx.createGain();
                g.gain.value = 0.2;
                g.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.5);
                src.connect(g); g.connect(this.ctx.destination);
                src.start();
            }
        };

        // --- GAME LOGIC ---
        class Aviator {
            constructor() {
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.balance = 10000.00;
                
                // Betting State for 2 panels
                this.bets = {
                    1: { elInp: document.getElementById('inpBet1'), elBtn: document.getElementById('btnBet1'), val: 10, state: 'IDLE', queued: false, winAmt: 0 },
                    2: { elInp: document.getElementById('inpBet2'), elBtn: document.getElementById('btnBet2'), val: 50, state: 'IDLE', queued: false, winAmt: 0 }
                };
                // State: IDLE -> BETTING (active in round) -> CASHED -> LOST

                this.gameState = 'LOADING'; // LOADING, FLYING, CRASHED
                this.mult = 1.00;
                this.crashPoint = 1.00;
                this.startTime = 0;
                this.stars = [];

                // Plane Asset
                this.plane = new Image();
                this.plane.src = `data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IiNFOTFFNjMiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTIxIDE2djQtMmwtOC01VjdsOCA1em0tMTAgNHYtM2w0IDN2M3ptLTggNHYtMmwyLTF2M2wtMiAweiIvPjwvc3ZnPg==`;

                this.initStars();
                this.resize();
                window.addEventListener('resize', () => this.resize());
                
                // Start Loop
                this.startLoadingPhase();
            }

            resize() {
                const p = this.canvas.parentElement;
                this.canvas.width = p.clientWidth;
                this.canvas.height = p.clientHeight;
                this.w = this.canvas.width;
                this.h = this.canvas.height;
            }

            initStars() {
                for(let i=0; i<50; i++) this.stars.push({ x: Math.random()*2000, y: Math.random()*1000, s: Math.random()*2 });
            }

            // -- Input Handling --
            adjustBet(id, delta) {
                const el = this.bets[id].elInp;
                let v = parseInt(el.value) + delta;
                if(v < 10) v = 10;
                el.value = v;
                this.renderBtn(id);
            }
            setBet(id, val) {
                this.bets[id].elInp.value = val;
                this.renderBtn(id);
            }

            clickBtn(id) {
                // Initialize Audio on first user interaction
                if(!AudioEngine.ctx) { 
                    AudioEngine.init(); 
                    document.getElementById('btnSound').innerText = 'ðŸ”Š';
                    document.getElementById('btnSound').classList.add('active');
                }

                const bet = this.bets[id];
                const amt = parseInt(bet.elInp.value);

                if (this.gameState === 'LOADING') {
                    // Phase: Preparing for round
                    if (bet.state === 'IDLE') {
                        if (this.balance < amt) return alert("Low Balance");
                        this.balance -= amt;
                        bet.val = amt;
                        bet.state = 'BET_PLACED'; // Ready to fly
                    } else if (bet.state === 'BET_PLACED') {
                        // Cancel
                        this.balance += amt;
                        bet.state = 'IDLE';
                    }
                } 
                else if (this.gameState === 'FLYING') {
                    // Phase: Flying
                    if (bet.state === 'ACTIVE') {
                        // CASHOUT!
                        const win = amt * this.mult;
                        this.balance += win;
                        bet.winAmt = win;
                        bet.state = 'CASHED';
                        AudioEngine.playWin();
                    } else if (bet.state === 'IDLE') {
                        // Bet for NEXT round
                        if (this.balance < amt) return;
                        this.balance -= amt;
                        bet.val = amt;
                        bet.queued = true;
                    } else if (bet.queued) {
                        // Cancel next round bet
                        this.balance += amt;
                        bet.queued = false;
                    }
                }
                
                this.updateUI();
                this.renderBtn(id);
            }

            // -- Visual Rendering of Buttons --
            renderBtn(id) {
                const bet = this.bets[id];
                const btn = bet.elBtn;
                const amt = parseInt(bet.elInp.value);

                // Reset Classes
                btn.className = 'btn-action';
                
                if (bet.state === 'CASHED') {
                    // Show Win
                    btn.classList.add('bg-green');
                    btn.innerHTML = `<div class="lbl-lg">WON</div><div class="lbl-sm">${bet.winAmt.toFixed(2)}</div>`;
                    return;
                }

                if (this.gameState === 'FLYING' && bet.state === 'ACTIVE') {
                    // CASHOUT MODE
                    btn.classList.add('bg-orange');
                    const curWin = (amt * this.mult).toFixed(2);
                    btn.innerHTML = `<div class="lbl-lg">CASH OUT</div><div class="lbl-sm">${curWin} INR</div>`;
                } 
                else if (bet.queued || (this.gameState === 'LOADING' && bet.state === 'BET_PLACED')) {
                    // WAITING / CANCEL MODE
                    btn.classList.add('bg-red');
                    if(bet.queued) {
                        btn.innerHTML = `<div class="lbl-lg">WAITING</div><div class="lbl-sm">NEXT ROUND</div>`;
                    } else {
                        btn.innerHTML = `<div class="lbl-lg">WAITING</div><div class="lbl-sm">CANCEL</div>`;
                    }
                } 
                else {
                    // DEFAULT BET MODE
                    btn.classList.add('bg-green');
                    btn.innerHTML = `<div class="lbl-lg">BET</div><div class="lbl-sm">${amt} INR</div>`;
                }
            }

            updateUI() {
                document.getElementById('uiBalance').innerText = this.balance.toFixed(2);
            }

            // -- Game Loop Phases --

            startLoadingPhase() {
                this.gameState = 'LOADING';
                this.mult = 1.00;
                
                // UI Resets
                document.getElementById('elLoader').style.display = 'flex';
                document.getElementById('elMult').style.display = 'none';
                document.getElementById('elCrash').style.display = 'none';
                
                AudioEngine.stopEngine();

                // Process Queued Bets from previous round
                [1,2].forEach(id => {
                    if(this.bets[id].queued) {
                        this.bets[id].queued = false;
                        this.bets[id].state = 'BET_PLACED';
                    }
                    // Reset wins/losses display to "Bet"
                    if(this.bets[id].state === 'CASHED' || this.bets[id].state === 'LOST') {
                        this.bets[id].state = 'IDLE';
                    }
                    this.renderBtn(id);
                });

                // Loading Bar Animation (3 seconds)
                let p = 0;
                const int = setInterval(() => {
                    p++;
                    this.drawScene(1); // Idle scene
                    if(p > 60) {
                        clearInterval(int);
                        this.startFlight();
                    }
                }, 50);
            }

            startFlight() {
                this.gameState = 'FLYING';
                document.getElementById('elLoader').style.display = 'none';
                document.getElementById('elMult').style.display = 'block';

                // Activate Placed Bets
                [1,2].forEach(id => {
                    if(this.bets[id].state === 'BET_PLACED') {
                        this.bets[id].state = 'ACTIVE';
                    }
                    this.renderBtn(id);
                });

                this.startTime = Date.now();
                this.crashPoint = this.getCrashPoint();
                AudioEngine.startEngine();
                
                requestAnimationFrame(() => this.loop());
            }

            loop() {
                if(this.gameState !== 'FLYING') return;

                const elapsed = (Date.now() - this.startTime) / 1000; // seconds
                // Math: Exponential growth
                this.mult = 1.0 + (0.06 * elapsed) + (0.04 * Math.pow(elapsed, 2));

                // Update DOM
                document.getElementById('elMult').innerText = this.mult.toFixed(2) + 'x';
                AudioEngine.updateEngine(this.mult);

                // Update Buttons (Cashout value changes)
                this.renderBtn(1);
                this.renderBtn(2);

                this.drawScene(this.mult);

                if (this.mult >= this.crashPoint) {
                    this.crash();
                } else {
                    requestAnimationFrame(() => this.loop());
                }
            }

            crash() {
                this.gameState = 'CRASHED';
                AudioEngine.stopEngine();
                AudioEngine.playCrash();

                document.getElementById('elMult').style.display = 'none';
                document.getElementById('elCrash').style.display = 'flex';
                document.getElementById('elCrashVal').innerText = this.crashPoint.toFixed(2) + 'x';

                this.addHistory(this.crashPoint);

                // Handle Losses
                [1,2].forEach(id => {
                    if(this.bets[id].state === 'ACTIVE') {
                        this.bets[id].state = 'LOST';
                    }
                    // Important: Reset button view immediately so they know they lost
                    this.renderBtn(id);
                });

                // Restart after delay
                setTimeout(() => this.startLoadingPhase(), 3000);
            }

            // -- Logic --
            getCrashPoint() {
                // Fair-ish distribution
                const r = Math.random();
                if (r < 0.02) return 1.00; // Instant crash chance
                const c = 0.99 / (1 - r);
                return Math.max(1.00, Math.min(c, 1000));
            }

            addHistory(val) {
                const bar = document.getElementById('historyBar');
                const pill = document.createElement('div');
                pill.className = `hist-pill ${val >= 10 ? 'p-pink' : val >= 2 ? 'p-purple' : 'p-blue'}`;
                pill.innerText = val.toFixed(2) + 'x';
                bar.prepend(pill); // Add to start
                if(bar.children.length > 20) bar.lastChild.remove();
            }

            // -- Drawing --
            drawScene(m) {
                this.ctx.fillStyle = '#101112';
                this.ctx.fillRect(0,0,this.w,this.h);

                // Draw Stars (Moving)
                this.ctx.fillStyle = '#666';
                this.stars.forEach(s => {
                    this.ctx.beginPath();
                    this.ctx.arc(s.x, s.y, s.s, 0, Math.PI*2);
                    this.ctx.fill();
                    s.x -= (m * 2) + 0.5;
                    if(s.x < 0) s.x = this.w;
                });

                // Draw Grid
                this.ctx.strokeStyle = '#222';
                this.ctx.lineWidth = 1;
                this.ctx.beginPath();
                for(let i=0; i<this.w; i+=80) { this.ctx.moveTo(i,0); this.ctx.lineTo(i,this.h); }
                for(let i=0; i<this.h; i+=80) { this.ctx.moveTo(0,i); this.ctx.lineTo(this.w,i); }
                this.ctx.stroke();

                if(this.gameState === 'LOADING') return;

                // Curve Calculation
                const norm = Math.min((m - 1) / 4, 1); // 0 to 1 scaling
                
                const startX = 0;
                const startY = this.h;
                const endX = this.w * 0.1 + (this.w * 0.7 * norm);
                const endY = this.h * 0.9 - (this.h * 0.7 * norm);

                const cpX = endX * 0.5;
                const cpY = this.h;

                // Fill Area
                const grad = this.ctx.createLinearGradient(0,0,0,this.h);
                grad.addColorStop(0, 'rgba(233,30,99,0.5)');
                grad.addColorStop(1, 'rgba(233,30,99,0)');
                
                this.ctx.beginPath();
                this.ctx.moveTo(startX, startY);
                this.ctx.quadraticCurveTo(cpX, cpY, endX, endY);
                this.ctx.lineTo(endX, this.h);
                this.ctx.lineTo(startX, this.h);
                this.ctx.fillStyle = grad;
                this.ctx.fill();

                // Stroke Line
                this.ctx.beginPath();
                this.ctx.moveTo(startX, startY);
                this.ctx.quadraticCurveTo(cpX, cpY, endX, endY);
                this.ctx.lineWidth = 4;
                this.ctx.strokeStyle = '#E91E63';
                this.ctx.stroke();

                // Draw Plane
                this.ctx.save();
                this.ctx.translate(endX, endY);
                this.ctx.rotate(-15 * Math.PI / 180);
                this.ctx.drawImage(this.plane, -25, -25, 50, 50);
                this.ctx.restore();
            }
        }

        // Init Game
        const game = new Aviator();

        // Sound Toggle Button
        const btnSound = document.getElementById('btnSound');
        btnSound.onclick = () => {
            const on = AudioEngine.toggle();
            btnSound.innerHTML = on ? 'ðŸ”Š' : 'ðŸ”‡';
            btnSound.classList.toggle('active', on);
        };

    </script>
</body>
</html>
